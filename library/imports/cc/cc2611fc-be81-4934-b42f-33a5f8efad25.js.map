{"version":3,"sources":["assets\\scripts\\common\\managers\\I18nMgr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import en from \"../i18n/en\";\nimport zh_cn from \"../i18n/zh_cn\";\nimport zh_tw from \"../i18n/zh_tw\";\nimport EventMgr from \"./EventMgr\";\n\nconst {ccclass, property} = cc._decorator;\n\n/** 地區/語系對照表 */\nconst LANGUAGE_MAPS = {\n    // 繁體中文\n    \"zh-tw\": [\n        \"zh-tw\", \"zh-cht\", \"zh-hk\", \"zh-mo\",\n    ],\n\n    // 簡體中文\n    \"zh-cn\": [\n        \"zh-cn\", \"zh-chs\",  \n    ],\n\n    // 英文\n    \"en\": [\n        \"en-us\", \"zh-sg\",\n    ],\n\n    // 葡萄牙文\n    \"pt\": [\n        \"pt-br\", \"pt-pt\",\n    ],\n\n    // 越南文\n    \"vi\": [\n        \"vi-vn\",\n    ],\n}\n\nconst DEFAULT_LANGUAGE = \"zh_tw\";\n\n@ccclass\nexport default class I18nMgr extends cc.Component {\n\n    public static Instance: I18nMgr = null;\n    //\n    private REF = null;\n    public i18nLabels = {};\n    public i18nSprites = {};\n    //\n    public defaultLanguage = \"zh_tw\";\n    public nowLanguage = null;\n\n\n    onLoad () {\n        if (I18nMgr.Instance === null) {\n            I18nMgr.Instance = this;\n        } else {\n            cc.error(\"[error:] i18n mgr has multi instances!!!\");\n            this.destroy();\n            console.log(\"[fix:] i18n mgr has been destroyed.\");\n            return;\n        };\n        //\n        this.init();\n        \n    }\n\n    start () {\n        // EventMgr.Instance.addEventListener(\"change_user_language\", this, this.listenChangeUserLanguage);\n        EventMgr.Instance.addEventListener(\"dialog:change_lang\", this, this.listenChangeUserLanguage);\n        this.create();\n    }\n\n    onDestroy(): void {\n        EventMgr.Instance.removeEventListener(\"dialog:change_lang\", this, this.listenChangeUserLanguage);\n    }\n\n    /** 初始化 */\n    public init(): void {\n        // let ref = JSON.stringify(zh_tw);\n        // this.i18nLabels = JSON.parse(ref);\n\n\n        // 1. 從url取\n        let localStorageData = localStorage.getItem(\"mtbcr:locale\");\n        if (!localStorageData) {\n            // let langParam = NetMgr.Instance.langParam;\n            // let langParam = GameApp.Instance.LangParam;\n            // http://localhost:7456/?token=32be7f7d0c05535ae58c52fe3301ed61&lang=zh_tw\n            let langParam = null;\n            let pLangParam = null;\n            let param = location.href.split('?')[1];\n            if (param) {\n                try {\n                    pLangParam = param.split('&')[1];\n                } catch (error) {\n                    console.error('lang param: ', error);\n                };\n            };\n\n            if (pLangParam) {\n                langParam = pLangParam.split('lang=')[1];\n            };\n\n\n            switch (langParam) {\n                case 'zh_tw':\n                    this.defaultLanguage = 'zh_tw';\n                    break;\n                case 'zh_cn':\n                    this.defaultLanguage = 'zh_cn';\n                    break;\n                case 'en':\n                    this.defaultLanguage = 'en';\n                    break;\n            \n                default:\n                    this.defaultLanguage = 'zh_tw';\n                    break;\n            };\n\n            this.nowLanguage = this.defaultLanguage;\n\n        } else if (localStorageData) {\n            this.nowLanguage = JSON.parse(localStorageData);\n        };\n\n        // 2.用手機系統語言取\n        // // 先取localstorage的紀錄\n        // let localStorageData = localStorage.getItem(\"mtbcr:locale\");\n        // // 若無紀錄\n        // // 用系統語言取(cc)\n        // if (!localStorageData) {\n        //     // 中文地區預設繁中, 其餘預設英文\n        //     if (cc.sys.language == 'zh') {\n        //         this.defaultLanguage = 'zh_tw';\n        //     } else {\n        //         this.defaultLanguage = 'en';\n        //     }\n        //     this.nowLanguage = this.defaultLanguage;\n        // } else if (localStorageData) {\n        //     this.nowLanguage = JSON.parse(localStorageData);\n        // };\n\n        // console.log('系統語言: ', cc.sys.language);\n        console.log('目前語言: ', this.nowLanguage);\n    }\n\n    private create(): void {\n        this.updateLang();\n    }\n\n    /** 建立全域i18n物件並且初始化使用者地區預設語言 */\n    public initArea(): void {\n        // 取得用戶預設語言區碼\n        // // let localArea: string = cc.sys.languageCode;\n        // let localArea: string = NetMgr.Instance.langParam;\n        // // 遍歷查找該用戶系統語言對應的語言包\n        // // 先給預設值\n        // // let defaultLanguage: string = DEFAULT_LANGUAGE;\n        // let localStorageData = JSON.parse(localStorage.getItem(\"localeSetting\"));\n        // // 中英雙語版本\n        // if (localArea == \"zh-tw\") {\n        //     this.defaultLanguage = \"zh_tw\";\n        // } else if (localArea == \"en\" || \"vi\" || \"pt\")  {\n        //     this.defaultLanguage = \"en\";\n        // } else {\n        //     this.defaultLanguage = \"zh_tw\";\n        // };\n        // // \n        // if (!localStorageData) {\n        //     // this.nowLanguage = this.defaultLanguage\n        //     if (NetMgr.Instance.langParam == \"zh-tw\") {\n        //         this.nowLanguage = \"zh_tw\";\n        //     } else if (NetMgr.Instance.langParam == \"zh-cn\") {\n        //         this.nowLanguage = \"zh_cn\";\n        //     } else {\n        //         this.nowLanguage = NetMgr.Instance.langParam;\n        //     };\n        // } else if (localStorageData) {\n        //     this.nowLanguage = localStorageData;\n        // }\n        // 正常遍歷\n        // for (let key in LANGUAGE_MAPS) {\n        //     let arr = LANGUAGE_MAPS[key];\n        //     arr.forEach(i => {\n        //         if (localArea == i) {\n        //             defaultLanguage = key;\n        //         };\n        //     });\n        // };\n\n\n        // this.updateLang();\n\n\n        console.log(\"default: \", this.defaultLanguage);\n        console.log(\"now: \", this.nowLanguage);\n    }\n\n    /** 更新/切換語言 */\n    private updateLang(): void {\n        switch (this.nowLanguage) {\n            case 'zh_tw':\n                this.REF = JSON.stringify(zh_tw);\n                this.i18nLabels = JSON.parse(this.REF);\n                break;\n\n            case 'zh_cn':\n                this.REF = JSON.stringify(zh_cn);\n                this.i18nLabels = JSON.parse(this.REF);\n                break;\n\n            case 'en':\n                this.REF = JSON.stringify(en);\n                this.i18nLabels = JSON.parse(this.REF);\n                break;\n        \n            default:\n                this.REF = JSON.stringify(zh_tw);\n                this.i18nLabels = JSON.parse(this.REF);\n                break;\n        };\n    }\n\n    private listenChangeUserLanguage(eventName, data): void {\n        if (data == this.nowLanguage || data == null) {\n            return;\n        };\n        this.nowLanguage = data;\n        this.updateLang();\n        localStorage.setItem(\"mtbcr:locale\", JSON.stringify(data));\n\n        EventMgr.Instance.dispatchEvent('i18n:change_lang', null);\n    }\n\n    /** 解析Excel文件 */\n\n    // update (dt) {}\n\n}\n"]}